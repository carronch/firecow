---
import { getEntry } from 'astro:content';
import OptimizedImage from './common/OptimizedImage.astro';
import { siteConfig } from '../config/site.config';

const homepageData = await getEntry('homepage', 'settings');
const homepage = homepageData?.data;

// 1. Try Site Config (CSV Data)
const configImages = siteConfig.gallery?.images || [];

// 2. Try Keystatic Data
const rawKeystaticImages = homepage?.galleryImages || [];
const keystaticImages = rawKeystaticImages.map((img: string) => 
    img.startsWith('http') ? img : `/images/gallery/${img}`
);

// 3. Fallback Images
const fallbackImages = [
  "https://images.unsplash.com/photo-1590523277543-a94d2e4eb00b?w=800&q=80",
  "https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=800&q=80",
  "https://images.unsplash.com/photo-1583212235753-b250a3b5b120?w=800&q=80",
  "https://images.unsplash.com/photo-1621262828626-4b8cc4821867?w=800&q=80"
];

// Determine which source to use
let imagesToDisplay = fallbackImages;

if (configImages.length > 0) {
    imagesToDisplay = configImages;
} else if (keystaticImages.length > 0) {
    imagesToDisplay = keystaticImages;
}
---
<section class="py-20 bg-white" id="gallery" aria-label="Photo Gallery">
    <div class="container mx-auto px-4">
      <div class="text-center mb-16">
        <span class="text-blue-700 font-bold tracking-wide uppercase text-sm">Visual Journey</span>
        <h2 class="text-4xl md:text-5xl font-bold font-heading mt-2 mb-4 text-gray-900">Gallery</h2>
        <p class="text-gray-700 text-lg max-w-2xl mx-auto">See the beauty that awaits you.</p>
      </div>
  
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {imagesToDisplay.map((img, index) => (
           <div class="aspect-square bg-slate-100 rounded-xl overflow-hidden group relative">
             <OptimizedImage 
               src={img} 
               class="w-full h-full object-cover transition duration-500 group-hover:scale-110" 
               alt={`Tour photo highlight ${index + 1}`}
               width={400}
               height={400}
             />
           </div>
        ))}
      </div>
    </div>
  </section>
